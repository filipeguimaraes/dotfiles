'use strict';(r=>{const e=r.rea;if(void 0!==e.globals._content)console.warn('content: Stop here, cause a second Tampermonkey instance was detected!\nThis can be caused by using "document.write" at Userscripts.\nSee https://code.google.com/p/chromium/issues/detail?id=253388 for more information');else{e.globals._content=!0;var m;r.Registry=(()=>{const d={};let f=[];const b=()=>{f=f.filter(a=>{let b=!1;a.r.forEach(a=>{d[a]||(b=!0)});if(b)return!0;a.fn()})},c=(a,c,k)=>{d[a]=k;b()},a=a=>{a=d[a];return a instanceof
Function?a():a};return{register:c,registerRaw:c,get:a,getRaw:a,require:function(a,c){f.push({r:a,fn:c});b()}}})();var t=(()=>{const d=b=>({}).toString.apply(b).match(/\s([a-z|A-Z]+)/)[1],f=b=>{if("Object"==d(b)){const c=[];for(const a in b)b.hasOwnProperty(a)&&c.push(a+":"+f(b[a]));return"{"+c.join(",")+"}"}if("Array"==d(b)){const c=[];b.forEach(a=>{c.push(f(a))});return"["+c.join(",")+"]"}return void 0===b?"undefined":null===b?"null":"Function"==d(b)?b.toString():'"'+b.toString()+'"'};return{createUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
b=>{const c=16*Math.random()|0;return("x"==b?c:c&3|8).toString(16)})},processQueue:function(b){let c;for(;c=b.shift();)c()},serialize:f,toType:d}})(),z=(()=>{const d={_content:!0,JSHINT:!0},f=/(webkitStorageInfo|webkitIDB.*|webkitIndexedDB|webkitOfflineAudioContext|webkitAudioContext|webkitURL|webkitSpeech.*|Bluetooth.*|MIDI.*|StorageManager)/;return()=>{const b={};let c,a;const p=Object.getOwnPropertyNames(window),h=((a,b)=>{for(;(a=Object.getPrototypeOf(a))&&a!==Object.prototype;)b=b.concat(Object.getOwnPropertyNames(a));
return b})(window,[]);c=0;for(a=null;a=h[c];c++)d[a]||f.exec(a)||(2<a.length&&"on"===a.substr(0,2)?b[a]={proto:!0,event:!0}:b[a]={proto:!0});c=0;for(a=null;a=p[c];c++)d[a]||b[a]||f.exec(a)||(2<a.length&&"on"===a.substr(0,2)?b[a]={window:!0,event:!0}:b[a]={window:!0});const k={addEventListener:{window:1},alert:{window:1},atob:{window:1},blur:{window:1},btoa:{window:1},clearInterval:{window:1},clearTimeout:{window:1},close:{window:1},confirm:{window:1},decodeURI:{window:1},decodeURIComponent:{window:1},
dispatchEvent:{window:1},encodeURI:{window:1},encodeURIComponent:{window:1},eval:{window:1},find:{window:1},focus:{window:1},getComputedStyle:{window:1},getSelection:{window:1},isFinite:{window:1},isNaN:{window:1},location:{window:1},open:{window:1},openDialog:{window:1},parseFloat:{window:1},parseInt:{window:1},postMessage:{window:1},print:{window:1},prompt:{window:1},removeEventListener:{window:1},resizeBy:{window:1},resizeTo:{window:1},scroll:{window:1},scrollBy:{window:1},scrollByLines:{window:1},
scrollByPages:{window:1},scrollTo:{window:1},setInterval:{window:1},setTimeout:{window:1},stop:{window:1}};Object.keys(k).forEach(a=>{b[a]||(b[a]=k[a])});return b}})(),g=t.createUUID(),u=window.self==window.top,x=0,v,l=(d=>{const f=(a,b)=>{const c=d.createEvent("MutationEvent");c.initMutationEvent(a,!1,!1,null,null,null,JSON.stringify(b),c.ADDITION);return c},b=(a,b)=>{let c;a&&(c=e[a])&&(c(b),delete e[a])};let c,a;var p;let h;var k=1,e={};return{init:function(k){h||(h=k);p="2P_"+h;a="2C_"+h;d.addEventListener.apply(d,
[a,a=>{const k=JSON.parse(a.attrName);"message.response"==k.m?b(k.r,k.a):c&&c(k,k.r?a=>{a=f(p,{m:"message.response",a,r:k.r});d.dispatchEvent.apply(d,[a])}:()=>{})},!1])},send:function(a,b,c){if(c){{const a=++k;e[k]=c;c=a}}else c=null;a=f(p,{m:a,a:b,r:c});d.dispatchEvent.apply(d,[a])},onMessage:{addListener:function(a){c=a}},cleanup:function(){d.removeEventListener.apply(d,[a,c,!1])}}})(document),y=(()=>{const d={};let f;const b=b=>{let a=[],c=[];var h={postMessage:function(a){l.send("port.message",
{response_id:b,value:a})},onMessage:{addListener:function(b){a.push(b)}},onDisconnect:{addListener:function(a){c.push(a)}},disconnect:function(){l.send("port.message",{response_id:b,disconnect:!0});h=c=a=null;delete d[b]}};d[b]={message:function(b){a&&a.forEach(a=>{a(b)})},disconnect:function(k){c&&c.forEach(a=>{a(k)});h=c=a=null;delete d[b]}};return h};return{message:function(c){let a;c.connect?f&&f(c.destination,b(c.response_id)):(a=d[c.response_id])?c.disconnect?a.disconnect():a.message(c.value):
m&&console.warn("ports: unkown id",c.response_id,c)},connect:function(c){const a=t.createUUID();l.send("port.message",{response_id:a,connect:!0,destination:c});return b(a)},onConnect:{addListener:function(b){f=b}}}})(),n=(()=>{let d,f;const b=[],c=[];let a=()=>{m&&console.log("content: detected DOMContentLoaded "+g);f=!0;window.removeEventListener("DOMContentLoaded",a,!1);a=null;t.processQueue(b)},e=()=>{m&&console.log("content: detected load "+g);d=f=!0;h.cleanup();t.processQueue(c)};window.addEventListener("DOMContentLoaded",
a,!1);window.addEventListener("load",e,!1);var h={registerDomListener:function(a){f||d?a():b.push(a)},registerPageListener:function(a){d?a():c.push(a)},forcedLoad:function(){d||f||!e||(m&&console.log("content: use forced load "+g),e(!0))},seen:(()=>{const a={};Object.defineProperties(a,{load:{get:function(){return d},enumerable:!0},DOMContentLoaded:{get:function(){return f},enumerable:!0}});return a})(),cleanup:function(){a&&(window.removeEventListener("DOMContentLoaded",a,!1),a=null);e&&(window.removeEventListener("load",
e,!1),e=null)}};return h})(),q=(()=>({init:function(d){e.page.eval("("+v.backup+')(window, document,"'+d+'",'+m+");\n")},cleanup:function(){l.send("cleanup")},next:function(d,f,b){const c={short_id:e.runtime.short_id};"isFirstPartyIsolation downloadMode enforce_strict_mode measure_scripts version external_connect statistics".split(" ").forEach(a=>{c[a]=d[a]});c.sandbox_allow_getters=!0;c.detect_constructors_by_keys=e.FEATURES.RUNTIME.DETECT_CONSTRUCTORS_BY_KEYS;c.inIncognitoContext=e.extension.inIncognitoContext;
c.blob_download_supported=!e.FEATURES.RUNTIME.FIREFOX;m&&(n.seen.load?console.log("content: Start ENV with page loaded "+g):n.seen.DOMContentLoaded?console.log("content: Start ENV with DOMContentLoaded "+g):console.log("content: Start ENV normally "+g));f=v.next(g,JSON.stringify(d.scripts),t.serialize(f),JSON.stringify(b),JSON.stringify(c),JSON.stringify({}),x,void 0,void 0,void 0,void 0,m,n.seen.load,n.seen.DOMContentLoaded,v.environment);l.send("next",{src:f})}}))(),w=(()=>{const d={registerMenuCommand:function(b){const c=
e.extension.connect("registerMenuCommand");c.onMessage.addListener(a=>{a.run&&null!==c&&b.postMessage("run")});c.onDisconnect.addListener(()=>{b.disconnect()});b.onMessage.addListener(a=>{if("register"===a.method){var b=a.name,d=a.uuid;a=a.accessKey;var e=[g,b,d].join("#");c.postMessage({method:"registerMenuCommand",name:b,uuid:d,menuId:e,accessKey:a})}});b.onDisconnect.addListener(()=>{c.disconnect()})},openInTab:function(b){const c=e.extension.connect("openInTab");c.onMessage.addListener(a=>{b.postMessage(a)});
c.onDisconnect.addListener(()=>{b.disconnect()});b.onMessage.addListener(a=>{if("openTab"==a.method){let b=a.url;a=a.options;if("boolean"===typeof a||void 0===a)a={loadInBackground:a};const d=void 0===a.active?void 0===a.loadInBackground?!1:!a.loadInBackground:a.active,e=void 0===a.insert?!0:a.insert;b&&0===b.search(/^\/\//)&&(b=location.protocol+b);c.postMessage({method:"openInTab",details:{url:b,options:{active:!!d,insert:!!e,incognito:!!a.incognito,setParent:!a.incognito&&!!a.setParent}}})}else void 0!==
a.name?c.postMessage({name:a.name}):a.close&&c.postMessage({close:!0})});b.onDisconnect.addListener(()=>{c.disconnect()})},download:function(b){const c=e.extension.connect("download");c.onMessage.addListener(a=>{b.postMessage(a)});c.onDisconnect.addListener(()=>{b.disconnect()});b.onMessage.addListener(a=>{a.cancel?c.postMessage({cancel:!0,id:g}):(a=a.details,a.url&&"/"===a.url[0]&&(a.url=location.origin+a.url),c.postMessage({method:"download",details:a,id:g}))});b.onDisconnect.addListener(()=>{c.disconnect()})},
webRequest:function(b){const c=e.extension.connect("webRequest");c.onMessage.addListener(a=>{b.postMessage(a)});c.onDisconnect.addListener(()=>{b.disconnect()});b.onMessage.addListener(a=>{c.postMessage({method:"webRequest",rules:a.rules,uuid:a.uuid})});b.onDisconnect.addListener(()=>{c.disconnect()})},xhr:function(b){const c=e.extension.connect("xhr");c.onMessage.addListener(a=>{b.postMessage(a)});c.onDisconnect.addListener(()=>{b.disconnect()});b.onMessage.addListener(a=>{c.postMessage(a)});b.onDisconnect.addListener(()=>
{c.disconnect()})},values:function(b){const c=e.extension.connect("values");c.onMessage.addListener(a=>{b.postMessage(a)});c.onDisconnect.addListener(()=>{b.disconnect()});b.onMessage.addListener(a=>{c.postMessage(a)});b.onDisconnect.addListener(()=>{c.disconnect()})}},f={setClipboard:function(b,c){const a=b.content;b=b.info;const d=typeof b;let h,f;"object"===d?(b.type&&(h=b.type),b.mimetype&&(f=b.mimetype)):"string"===d&&(h=b);const g=f||("html"==h?"text/html":"text/plain");if(e.FEATURES.RUNTIME.CLIPBOARD_API)e.extension.sendMessage({method:"clipboard",
mimetype:g,content:a},()=>c());else{const b=c=>{document.removeEventListener("copy",b,!0);c.stopImmediatePropagation();c.preventDefault();c.clipboardData.setData(g,a)};document.addEventListener("copy",b,!0);document.execCommand("copy");c()}},notification:function(b,c){b.method="notification";e.extension.sendMessage(b,c)},syntaxCheck:function(b,c){b.method="syntaxCheck";e.extension.sendMessage(b,c)},closeTab:function(b,c){e.extension.sendMessage({method:"closeTab",id:g},a=>{a.error&&console.warn(a.error);
c()})},focusTab:function(b,c){e.extension.sendMessage({method:"focusTab",id:g},a=>{a.error&&console.warn(a.error);c()})},addElement:(b,c)=>{try{const a=document.createElement(b.tag),d=b.properties;Object.keys(d).forEach(b=>{"textContent"==b?a.textContent=d[b]:a.setAttribute(b,d[b])});b.id&&a.setAttribute("id",b.id);(document.head||document.body||document.documentElement||document).appendChild(a);c()}catch(a){console.warn("content: error adding script",a)}},tabs:function(b,c){b.method="tabs";e.extension.sendMessage(b,
a=>{c(a.data)})},cookie:function(b,c){b.method="cookie";e.extension.sendMessage(b,a=>{c(a.data)})},api:function(b){b.method="api";e.extension.sendMessage(b,()=>{})}};return{init:function(){},getApi:function(){const b={};[f,d].forEach(c=>{Object.keys(c).map(a=>{b["GM_"+a]=c[a]})});return b},processMessage:function(b,c,a){if(b=f[b])return b(c,a);a()},processConnect:function(b,c){if(b=d[b])return b(c)}}})();e.extension.onMessage.addListener((d,e,b)=>{d.id&&d.id!=g?console.warn("content: Not for me! "+
g.substr(0,10)+"!="+d.id):"executeScript"==d.method?d.url&&0!==window.location.href.search(d.url)?m&&console.log("exec: URL doesn't match",window.location,d):d.topframe&&!u?m&&console.log("exec: topframe doesn't match",window.self,d):l.send("executeScript",d):"onLoad"==d.method?(document.readyState&&"complete"!==document.readyState||n.forcedLoad(),b({})):u&&("loadUrl"==d.method?(window.location=d.url,b({})):"reload"==d.method?(window.location.reload(),b({})):"confirm"==d.method?window.setTimeout(()=>
{const c=window.confirm(d.msg);b({confirm:c})},100):"showMsg"==d.method?window.setTimeout(()=>{window.setTimeout(()=>{window.alert(d.msg)},1);b({})},100):"setForeignAttr"==d.method?(l.send(d.method,d),b({})):window.console.log("content: unknown method "+d.method))});y.onConnect.addListener((d,e)=>{w.processConnect(d,e)});l.onMessage.addListener((d,f)=>{if("document.write"==d.m){const b=document.documentElement;window.setTimeout(()=>{b!==document.documentElement&&l.init()},0)}else"port.message"==d.m?
y.message(d.a):"csp"==d.m?e.page.eval('window["'+d.a.id+'"] = function() { '+d.a.src+" };\n"):"external.message"==d.m?e.extension.sendMessage({method:"externalMessage",request:d.a},b=>{f(b)}):w.processMessage(d.m,d.a,f)});Registry.require(["page.js"],()=>{v=Registry.getRaw("page.js");let d=!1;const f=(a,b,c)=>{let f=1;const h=()=>{m&&console.debug('content: send "prepare" message');e.extension.sendMessage({method:"prepare",id:g,topframe:u,url:window.location.href},e=>{d||(e?(d=!0,e.contexters||e.scripts&&
e.scripts.length||e.external_connect?(c&&c(),b(e)):(q.cleanup(),a())):(m&&console.debug("content: _early_ execution, connection to bg failed -> retry!"),window.setTimeout(h,f),f*=2))})};e.content.onReady(h)},b=location.pathname+location.search,c="TM_"+e.runtime.short_id+window.btoa(b.length+b).substr(0,255).replace(/[#=\/]/g,"_"),a=()=>{let a;let b;try{b=document.cookie.split(";")}catch(A){return}for(a=0;a<b.length;a++){var d=b[a].substr(0,b[a].indexOf("="));var e=b[a].substr(b[a].indexOf("=")+1);
d=d.replace(/^\s+|\s+$/g,"");if(0===d.indexOf(c)&&(document.cookie=d+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;",d=window.decodeURIComponent(e),0===d.indexOf("blob:")&&(e=new XMLHttpRequest,e.open("GET",d,!1),e.send(null),200===e.status||0===e.status)))try{return JSON.parse(e.responseText)}catch(A){console.warn("content: unable to decode"+e.responseText)}}},p=document.contentType&&"text/html"!=document.contentType;((a,b,c)=>{p?window.setTimeout(()=>{a(b,c)},1):a(b,c)})((b,c)=>{m&&console.log("content: Started ("+
g+", "+window.location.origin+window.location.pathname+")",r.tm_info);let d;e.FEATURES.RUNTIME.FAST_EXEC_SUPPORT&&(d=a())||(d=r.tm_info)?(delete r.tm_info,d.contexters||d.scripts&&d.scripts.length||d.external_connect?(q.init(g),l.init(g),c(d,"sync")):b(),e.FEATURES.RUNTIME.FAST_EXEC_SUPPORT&&e.extension.sendMessage({method:"prepare",url:window.location.href,cleanup:!0},()=>{})):p?f(b,c,()=>{q.init(g);l.init(g)}):(q.init(g),l.init(g),f(b,c))},()=>{m&&console.log("content: disable event processing for "+
g);n.cleanup();q.cleanup();l.cleanup()},(a,b)=>{x=a.logLevel;m|=60<=x;n.registerDomListener(()=>{l.send("DOMContentLoaded")});n.registerPageListener(()=>{l.send("load")});m&&console.log("content: "+(b||"normal")+" start event processing for "+g+" ("+a.scripts.length+" to run)");w.init(a.scripts);q.next(a,w.getApi(),z());u||window.addEventListener("unload",()=>{e.extension.sendMessage({method:"unLoad",id:g,topframe:!1,url:window.location.href},()=>{});n.cleanup();q.cleanup();l.cleanup()},!1)})})}})(window);
